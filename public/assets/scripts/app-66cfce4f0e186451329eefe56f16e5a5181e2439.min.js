DOM.Ready(function(){ActivateShowlinks();ActivateMethodLinks();});function ActivateMethodLinks(){DOM.On('a[method="post"], a[method="delete"]','click',function(e){if(this.getAttribute('method')=='delete'){if(!confirm('Are you sure you want to delete this item, this action cannot be undone?')){return false;}}
var url=this.getAttribute('href');var redirect=this.getAttribute('data-redirect');DOM.Post(url,null,function(){if(redirect!==null){window.location=redirect;}else{window.location.reload();}},function(){console.log("#error POST to"+url+"failed");});e.preventDefault();return false;});DOM.On('a[method="back"]','click',function(e){history.back();e.preventDefault();return false;});}
function ActivateShowlinks(){DOM.On('.show','click',function(e){var selector=this.getAttribute('data-show');console.log("SELECTOR",selector)
DOM.Each(selector,function(el,i){console.log("FOUND",el)
if(!el.className.match(/hidden/gi)){el.className='hidden';}else{el.className=el.className.replace(/hidden/gi,'');}
console.log("after",el)});e.preventDefault();return false;});}
DOM.Ready(function(){Editable.Activate('.content-editable-toolbar');});var Editable=(function(){return{Activate:function(s){if(!DOM.Exists(s)){return;}
DOM.Each('.content-editable-toolbar',function(toolbar){toolbar.buttons=toolbar.querySelectorAll('a');var dataEditable=toolbar.getAttribute('data-editable');toolbar.editable=DOM.First(DOM.Format("#{0}-editable",dataEditable));toolbar.textarea=DOM.First(DOM.Format("#{0}-textarea",dataEditable));if(toolbar.editable===undefined){toolbar.editable=DOM.Nearest(toolbar,'.content-editable')[0];}
if(toolbar.textarea===undefined){toolbar.textarea=DOM.Nearest(toolbar,'.content-textarea')[0];}
toolbar.textarea.style.display='none';toolbar.textarea.form.addEventListener('submit',function(e){Editable.updateContent(toolbar.editable,toolbar.textarea,false);return false;});toolbar.editable.addEventListener('input',function(e){Editable.cleanHTMLElements(this);});DOM.ForEach(toolbar.buttons,function(el,i){el.addEventListener('click',function(e){var cmd=this.id;var insert="";switch(cmd){case"showCode":Editable.updateContent(toolbar.editable,toolbar.textarea,true);break;case"createLink":insert=prompt("Supply the web URL to link to");if(insert.indexOf('http')!==0){insert="http://"+insert;}
break;case"formatblock":insert=this.getAttribute('data-format');break;default:break;}
if(cmd.length>0){document.execCommand(cmd,false,insert);}
var sel=Editable.getSelectionParentElement();if(sel!==null){Editable.cleanAlign(cmd,sel);Editable.cleanHTMLElements(sel);sel.removeAttribute('style');}
return false;});});});},cleanAlign:function(cmd,el){switch(cmd){case"justifyCenter":if(sel.hasClass('align-center')){sel.removeClass('align-center');}else{sel.addClass('align-center');}
sel.removeClass('align-left').removeClass('align-right');sel.removeAttr('style');break;case"justifyLeft":if(sel.hasClass('align-left')){sel.removeClass('align-left');}else{sel.addClass('align-left');}
sel.removeClass('align-center').removeClass('align-right');sel.removeAttribute('style');break;case"justifyRight":if(sel.hasClass('align-right')){sel.removeClass('align-right');}else{sel.addClass('align-right');}
sel.removeClass('align-center').removeClass('align-left');sel.removeAttribute('style');break;}},cleanHTML:function(html){html=html.replace(/<\/?span>/gi,'');html=html.replace(/<\/?font [^>]*>/gi,'');html=html.replace(/&nbsp;</gi,' <');html=html.replace(/<p><\/p>/gi,'\n');html=html.replace(/<br><\/li>/gi,'<\/li>');html=html.replace(/<!--[\w\d\[\]\s<\/>:.!="*{};-]*-->/gi,'');html=html.replace(/ class\=\"MsoNormal\"/gi,'');html=html.replace(/<p><o:p> <\/o:p><\/p>/gi,'');html=html.replace(/><(li|ul|ol|p|h\d|\/ul|\/ol)>/gi,'>\n<$1>');return html;},cleanHTMLElements:function(el){DOM.ForEach(el.querySelectorAll('p, div, b, i, h1, h2, h3, h4, h5, h6'),function(e){e.removeAttribute('style');});DOM.ForEach(el.querySelectorAll('span'),function(e){e.removeAttribute('style');e.removeAttribute('lang');});DOM.ForEach(el.querySelectorAll('font'),function(e){e.removeAttribute('color');});},updateContent:function(editable,textarea,toggle){var html='';if(textarea.style.display!=='none'){html=textarea.value;editable.innerHTML=html;if(toggle){editable.style.display='';textarea.style.display='none';}}else{html=editable.innerHTML;html=Editable.cleanHTML(html);textarea.value=html;if(toggle){editable.style.display='none';textarea.style.display='';}}},getSelectionParentElement:function(){var p=null,sel;if(window.getSelection){sel=window.getSelection();if(sel.rangeCount){p=sel.getRangeAt(0).commonAncestorContainer;if(p.nodeType!=1){p=p.parentNode;}}}else if((sel=document.selection)&&sel.type!="Control"){p=sel.createRange().parentElement();}
return p;}};}());DOM.Ready(function(){SetSubmitStoryName();});function SetSubmitStoryName(){DOM.On('.active_url_field','change',function(e){DOM.First('.active_name_field').value=urlToSentenceCase(this.value);});}
function urlToSentenceCase(url){var parts,name
url=url.replace(/\/$/,"");parts=url.split("/");name=parts[parts.length-1];name=name.replace(/^\d*-/,"");name=name.replace(/\..*$/,"");name=name.replace(/-/g," ");name=name.trim();name=name.toLowerCase();name=name[0].toUpperCase()+name.substring(1);return name}